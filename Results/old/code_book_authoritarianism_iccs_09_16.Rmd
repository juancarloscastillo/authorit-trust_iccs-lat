---
title: "Trust in political institutions and support for authoritarianism in Latin American students: Does civic knowledge make a difference?"
author: "Daniel Miranda, Juan Carlos Castillo, Catalina Miranda & José Conejeros"
date: '`r format(Sys.time(), "%d/%m/%Y")`'
output: 
  html_document:
    theme: cosmo
    highlight: tango
    code_folding: hide
    toc: yes
    toc_float: true
---

Below are descriptive and correlational statistics with data from to the International Civic and Citizenship Education Study (ICCS) 2009 and 2016, in which six (Chile, Mexico, Colombia, Paraguay, Guatemala, and the Dominican Republic) and five (Chile, Mexico, Colombia, Peru, and the Dominican Republic) Latin American countries participated, respectively. The following sections are presented: change in support for dictatorship, support for Dictatorship on civic knowledge and support for Dictatorship on institutional trust

```{r global options, warning=FALSE, cache=FALSE, include=FALSE, results="asis"}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls()) #remove all previous objects
options(scipen=999)
#Package
library(knitr)
library(DT)
library(plyr)
library(dplyr)
library(haven)
library(texreg) 
library(xtable) 
library(kableExtra) 
library(ggplot2)
library(psych)
library(purrr)
library(tidyr)
library(sjmisc)
library(Hmisc)
library(reshape)
library(VIM)
library(stringr)
library(skimr)
library(lme4)
library(broom)
library(survey)
library(srvyr)
```

# Data Frames

+ ICCS 2009 Latin American Countries: Chile, Mexico, Colombia, Paraguay, Guatemala, and the Dominican Republic

```{r iccs09, warning=FALSE, cache=FALSE, results="asis"}
#ICCS 2009: Latinamerica module. Merge two data-frames: 
#1. Test civic knowledge (ISL)
#2. Students questionary (ISG)

#Chile
chi09 <-  as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/islchlc2.sas7bdat"))
chi092 <-  as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isgchlc2.sas7bdat")) 
chi     <- merge(chi09, chi092, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Mexico
mex09 <-  as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/islmexc2.sas7bdat"))
mex092 <-  as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isgmexc2.sas7bdat"))
mex   <- merge(mex09, mex092, by="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Colombia
col09 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/islcolc2.sas7bdat"))
col092 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isgcolc2.sas7bdat"))
col   <- merge(col09, col092, by="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Paraguay
pry09 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/islpryc2.sas7bdat"))
pry092 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isgpryc2.sas7bdat"))
pry   <- merge(pry09, pry092, by="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Guatemala
gtm09 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/islgtmc2.sas7bdat"))
gtm092 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isggtmc2.sas7bdat"))
gtm   <- merge(gtm09, gtm092, by="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Domincan Republic
dom09 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isldomc2.sas7bdat"))
dom092 <- as.data.frame(read_sas("ICCS2009_IDB_SAS/Data_G8/isgdomc2.sas7bdat"))
dom   <- merge(dom09, dom092, by="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Append: all obervations preserve
iccs09 <- rbind(chi, mex, col, pry, gtm, dom)
#class(iccs09)
#dim(iccs09)
#head(iccs09)
#str(iccs09)
#names(iccs09)
#dplyr::glimpse(iccs09) # general structure
#ICCS 2009
save(iccs09, file = "BBDD_ICCS/ICCS09.Rdata")
```

+ ICCS 2016: Chile, Mexico, Colombia, Peru, and the Dominican Republic

```{r iccs16, warning=FALSE, cache=FALSE, results="asis"}
#ICCS 2016: Latinamerica module, student questionnaire
#Chile
chi16 <-  as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/islchlc3.sas7bdat"))
chi162 <-  as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isgchlc3.sas7bdat"))
chi     <- merge(chi16, chi162, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#México
mex16 <-  as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/islmexc3.sas7bdat"))
mex162 <-  as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isgmexc3.sas7bdat"))
mex     <- merge(mex16, mex162, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Colombia
col16 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/islcolc3.sas7bdat"))
col162 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isgcolc3.sas7bdat"))
col     <- merge(col16, col162, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#República Dominicana
dom16 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isldomc3.sas7bdat"))
dom162 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isgdomc3.sas7bdat"))
dom     <- merge(dom16, dom162, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Perú
per16 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/islperc3.sas7bdat"))
per162 <- as.data.frame(read_sas("ICCS2016_IDB_SAS/Data/isgperc3.sas7bdat"))
per     <- merge(per16, per162, by ="IDSTUD", all=FALSE, suffixes = c("",".y"))#Merge
#Append: all obervations preserve
iccs16 <- rbind(chi, mex, col, dom, per)
rm(chi,mex,col,dom,per,pry,gtm)
#class(iccs16)
#dim(iccs16)
#head(iccs16)
#str(iccs116)
#names(iccs16)
#dplyr::glimpse(iccs16) # ver estructura general
#ICCS 2016
save(iccs16, file = "BBDD_ICCS/ICCS16.Rdata")
#Load Data
load("BBDD_ICCS/ICCS09.Rdata") #29896 obs - 128 vars
load("BBDD_ICCS/ICCS16.Rdata") #25319 obs - 168 vars
#skim(iccs09)
#skim(iccs16)
```

# Process Data

+ Process General Databases ICCS 2009 and ICCS 2016

```{r dir, warning=FALSE, cache=FALSE, results="asis"}
#Directorio imagenes 
setwd("GRAPH")
```

## Chile

```{r chile, warning=FALSE, cache=FALSE, include=FALSE, results="asis"}
#2016
names(chi16)
chi16= chi16 %>%
    dplyr::rename_all(tolower) %>%
    dplyr::mutate(time="2016") %>%
    dplyr::mutate (gob1= 5 - ls3g01a)%>% #inverse
    dplyr::mutate (gob2= 5 - ls3g01b)%>%
    dplyr::mutate (gob3= 5 - ls3g01c)%>%
    dplyr::mutate (gob4= 5 - ls3g01d)%>%
    dplyr::mutate (gob5= 5 - ls3g01e)%>%
    dplyr::mutate (gob6= 5 - ls3g01f)%>%
    dplyr::mutate (dicta1= 5 - ls3g02d)%>%
    dplyr::mutate (dicta2= 5 - ls3g02e)%>%
    dplyr::mutate (autori= l_autgov)%>%
    dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2, autori) 

#2009
chi09= chi09 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2009") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::mutate(autori=autgov)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2, autori) 

#Merge    
mergeiccs=full_join(chi16, chi09)
```

+ Dictatorship are justified when bring order and security

```{r dicta1chi, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
#Frecuency
        mergesvy <-  mergeiccs %>%
        filter(country=="CHL") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_01 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
      
      
      df=data.frame(table_freq_01, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df1_chi <- df %>% mutate(country="CHI")
      
      order_chile=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security - Chile") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph
print(order_chile)

```

+ Dictatorship are justified when bring economic benefits

```{r dicta2chi, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="CHL") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_08 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
       df=data.frame(table_freq_08, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df2_chi <- df %>% mutate(country="CHI")
      
      order_ch2q1=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()

      print(order_ch2q1)
```

## México

```{r mex, warning=FALSE, cache=FALSE, results="asis"}
#2016
      mex16= mex16 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2015") %>%
      dplyr::mutate (gob1= 5 - ls3g01a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls3g01b)%>%
      dplyr::mutate (gob3= 5 - ls3g01c)%>%
      dplyr::mutate (gob4= 5 - ls3g01d)%>%
      dplyr::mutate (gob5= 5 - ls3g01e)%>%
      dplyr::mutate (gob6= 5 - ls3g01f)%>%
      dplyr::mutate (dicta1= 5 - ls3g02d)%>%
      dplyr::mutate (dicta2= 5 - ls3g02e)%>%
      dplyr::select(country,totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

#2009
mex09= mex09 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2008") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

#Merge
mergeiccs=full_join(mex16,mex09)
```

+ Dictatorship are justified when bring order and security

```{r dicta1mex, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="MEX") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_01 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
  df=data.frame(table_freq_01, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
     
      df1_mex <- df %>% mutate(country="MEX")
      
      order_mexico=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security - MEX") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph 
print(order_mexico)
        
```

+ Dictatorship are justified when bring economic benefits

```{r dicta2mex, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="MEX") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)

      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
       df2_mex <- df %>% mutate(country="MEX")
      order_mex=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()
#Graph      
print(order_mex)
            
      
```

## Colombia

```{r colombia, warning=FALSE, cache=FALSE, results="asis"}
#2016
      col16= col16 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2015") %>%
      dplyr::mutate (gob1= 5 - ls3g01a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls3g01b)%>%
      dplyr::mutate (gob3= 5 - ls3g01c)%>%
      dplyr::mutate (gob4= 5 - ls3g01d)%>%
      dplyr::mutate (gob5= 5 - ls3g01e)%>%
      dplyr::mutate (gob6= 5 - ls3g01f)%>%
      dplyr::mutate (dicta1= 5 - ls3g02d)%>%
      dplyr::mutate (dicta2= 5 - ls3g02e)%>%
      dplyr::select(country,totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

#2009
col09= col09 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2008") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

mergeiccs=full_join(col16,col09)
```

+ Dictatorship are justified when bring economic benefits

```{r dicta1col, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="COL") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_01 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
       df=data.frame(table_freq_01, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
       df1_col <- df %>% mutate(country="COL")
      order_colombia=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security - COL") +
        labs(x = "Response", y = "%") +
        geom_col()
#Graph      
      print(order_colombia)
      
```

+ Dictatorship are justified when bring economic benefits

```{r dicta2col, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="COL") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
       df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
      
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
         df2_col <- df %>% mutate(country="COL")
      order_colom=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits - COL") +
        labs(x = "Response", y = "%") +
        geom_col()
#Graph
      print(order_colom)
```

# Dominican Republic

```{r dom, warning=FALSE, cache=FALSE, results="asis"}
#2016
      dom16= dom16 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2015") %>%
      dplyr::mutate (gob1= 5 - ls3g01a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls3g01b)%>%
      dplyr::mutate (gob3= 5 - ls3g01c)%>%
      dplyr::mutate (gob4= 5 - ls3g01d)%>%
      dplyr::mutate (gob5= 5 - ls3g01e)%>%
      dplyr::mutate (gob6= 5 - ls3g01f)%>%
      dplyr::mutate (dicta1= 5 - ls3g02d)%>%
      dplyr::mutate (dicta2= 5 - ls3g02e)%>%
      dplyr::select(country,totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

#2009
      dom09= dom09 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2008") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

mergeiccs=full_join(dom16,dom09)
```

+ Dictatorship are justified when bring order and security

```{r dicta1dom, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="DOM") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
         df1_dom <- df %>% mutate(country="DOM")
      order_dominicana=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security - DOM") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph
      print(order_dominicana)
```

+ Dictatorship are justified when bring economic benefits

```{r dicta2dom, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
 mergesvy <-  mergeiccs %>%
        filter(country=="DOM") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_01 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
      df=data.frame(table_freq_01, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df2_dom <- df %>% mutate(country="DOM")
      order_dom=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits -DOM") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph 
      print(order_dom)
      
```

## Guatemala

```{r guatemala, warning=FALSE, cache=FALSE, results="asis"}
#2009
gtm= gtm09 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2008") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 
mergeiccs=(gtm)
```

+ Dictatorship are justified when bring order and security

```{r dicta1gtm, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="GTM") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
            df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df1_gtm <- df %>% mutate(country="GTM")
    
      order_guatemala=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph
      print(order_guatemala)
      
```

+ Dictatorship are justified when bring economic benefits

```{r dicta2gtm, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="GTM") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df2_gtm <- df %>% mutate(country="GTM")
         
      order_guatemala=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()

#Graph
      print(order_guatemala)
      
```

## Perú

```{r peru, warning=FALSE, cache=FALSE, results="asis"}
#2016 
      per= per16 %>%
      rename_all(tolower) %>%
      dplyr::mutate(time="2015") %>%
      dplyr::mutate (gob1= 5 - ls3g01a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls3g01b)%>%
      dplyr::mutate (gob3= 5 - ls3g01c)%>%
      dplyr::mutate (gob4= 5 - ls3g01d)%>%
      dplyr::mutate (gob5= 5 - ls3g01e)%>%
      dplyr::mutate (gob6= 5 - ls3g01f)%>%
      dplyr::mutate (dicta1= 5 - ls3g02d)%>%
      dplyr::mutate (dicta2= 5 - ls3g02e)%>%
      dplyr::select(country,totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 
mergeiccs=(per)
```

+ Dictatorship are justified when bring order and security

```{r dicta1per, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="PER") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
 
      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very  agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df1_per <- df %>% mutate(country="PER")
         order_per=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security") +
        labs(x = "Response", y = "%") +
        geom_col()
           
#Graph
print(order_per)
```

+ Dictatorship are justified when bring economic benefits


```{r dicta2per, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="PER") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)

       df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
            df2_per <- df %>% mutate(country="PER")
      order_per=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()
      
#Graph
      print(order_per)
      
```

## Paraguay

```{r paraguay, warning=FALSE, cache=FALSE, results="asis"}
pry= pry09 %>%
 rename_all(tolower) %>%
      dplyr::mutate(time="2008") %>%
      dplyr::mutate (gob1= 5 - ls2p02a)%>% #invertidos
      dplyr::mutate (gob2= 5 - ls2p02b)%>%
      dplyr::mutate (gob3= 5 - ls2p02c)%>%
      dplyr::mutate (gob4= 5 - ls2p02d)%>%
      dplyr::mutate (gob5= 5 - ls2p02e)%>%
      dplyr::mutate (gob6= 5 - ls2p02f)%>%
      dplyr::mutate (dicta1= 5 - ls2p03d)%>%
      dplyr::mutate (dicta2= 5 - ls2p03e)%>%
      dplyr::select(country, totwgts, jkzones, jkreps, time, gob1, gob2, gob3, gob4, gob5, gob6, dicta1, dicta2) 

mergeiccs=(pry)
```

+ Dictatorship are justified when bring order and security

```{r dicta1pry, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="PRY") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta1) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      
      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta1, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
      #df <- data.frame(trt = c("a", "b", "c", "d"), outcome = c(0.136, 0.212, 0.477, 0.176), study=c(09, 09, 09, 09))
      df1_pry <- df %>% mutate(country="PRY")
               order_pry=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security") +
        labs(x = "Response", y = "%") +
        geom_col()
               
#Graph
  print(order_pry)   
      
```

+ Dictatorship are justified when bring economic benefits

```{r dicta2pry, warning=FALSE, cache=FALSE, results="asis", tidy=TRUE}
        mergesvy <-  mergeiccs %>%
        filter(country=="PRY") %>%
        as_survey_design(
        strata = jkzones, 
        weights = totwgts, 
        ids = jkreps, 
        nest = TRUE)

    # frequency table via taylor series linearization
      table_freq_02 <- mergesvy %>%
        dplyr::group_by(time, dicta2) %>%
        summarize(proportion = survey_mean(,na.rm=TRUE))
      #help(srvyr)
      df=data.frame(table_freq_02, digits=2)
      #summary(factor(df$proportion))
      
      df= df %>%
        mutate(perc = proportion * 100) %>%
        mutate(p=round(perc, 2)) %>%
        mutate(label=factor(dicta2, labels=c("Very disagree", "Disagree", "Agree", "Very agree"))) 
     
              df2_pry <- df %>% mutate(country="PRY")
      order_pry=ggplot(df, aes(label, proportion)) +
        facet_wrap(~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()
      
#Graph
  print(order_pry)
      
```

# All Latinamerica Countries

## Change in support for dictatorship

+ Dictatorships are justified when they bring order and security 2009-2016: LS2P03E - LS3G02E

```{r latin, warning=FALSE, cache=FALSE, results="asis"}
df1 <- rbind(df1_chi, df1_mex, df1_col, df1_dom, df1_per, df1_pry, df1_gtm)

ggplot(df1 , aes(label, proportion)) +
        facet_grid(country ~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+ 
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security") +
        labs(x = "Response", y = "%") +
        geom_col()

```

+ Dictatorships are justified when they bring economic benefits 2009-2016: LS2P03D - LS3G02D

```{r latin2, warning=FALSE, cache=FALSE, results="asis"}
df2 <- rbind(df2_chi, df2_mex, df2_col, df2_dom, df2_per, df2_pry, df2_gtm)

ggplot(df2 , aes(label, proportion)) +
        facet_grid(country ~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+ 
 scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()

```

## Change in support for dictatorship (DUMMY)

+ Dictatorships are justified when they bring order and security 2009-2016: LS2P03D - LS3G02D (DUMMY)

```{r dum1, warning=FALSE, cache=FALSE, results="asis"}
library(purrr)

aux09_i <- c("chi09", "mex09", "col09", "dom09","gtm", "pry","")
aux16_i <- c("chi16", "mex16", "col16", "dom16", "", "","per")
pais0_i <- c("CHL","MEX","COL","DOM","GTM","PRY","PER")
pais_i  <- c("CHI","MEX","COL","DOM","GTM","PRY","PER")

df_final <- NULL 

for(i in 1:7){
  
if(aux09_i[i]!="") {aux09 <- get(aux09_i[i])}
if(aux16_i[i]!="") {aux16 <- get(aux16_i[i])}
pais0 = pais0_i[i]
pais = pais_i[i]

aux09 <- aux09 %>% 
  mutate(dicta1 = case_when(
    dicta1 %in% c(1,2) ~ 1,
    dicta1 %in% c(3,4) ~ 2,
    is.na(dicta1) ~ dicta1,
    TRUE ~ 0
  )) %>% 
  mutate(dicta2 = case_when(
    dicta2 %in% c(1,2) ~ 1,
    dicta2 %in% c(3,4) ~ 2,
    is.na(dicta2) ~ dicta2,
    TRUE ~ 0
  )) 
aux16 <- aux16 %>% 
  mutate(dicta1 = case_when(
    dicta1 %in% c(1,2) ~ 1,
    dicta1 %in% c(3,4) ~ 2,
    is.na(dicta1) ~ dicta1,
    TRUE ~ 0
  )) %>% 
  mutate(dicta2 = case_when(
    dicta2 %in% c(1,2) ~ 1,
    dicta2 %in% c(3,4) ~ 2,
    is.na(dicta2) ~ dicta2,
    TRUE ~ 0
  )) 

if(aux09_i[i]!="" & aux16_i[i]!=""){ mergeiccs=full_join(aux16, aux09) }
if(aux09_i[i]!="" & aux16_i[i]==""){ mergeiccs= aux09 }
if(aux09_i[i]=="" & aux16_i[i]!=""){ mergeiccs= aux16 }

mergesvy <-  mergeiccs %>%
      filter(country==pais0) %>%
      as_survey_design(
      strata = jkzones, 
      weights = totwgts, 
      ids = jkreps, 
      nest = TRUE)
names(mergesvy)
# frequency table via taylor series linearization
  table_freq_01 <- mergesvy %>%
    dplyr::group_by(time, dicta1) %>%
    summarize(proportion = survey_mean(dicta1,na.rm=TRUE))
  #help(srvyr)

  df = data.frame(table_freq_01, digits=2)

  df= df %>%
    mutate(perc = proportion * 100) %>%
    mutate(p=round(perc, 2)) %>%
    mutate(label=factor(dicta1, labels=c("Disagree", "Agree"))) %>% 
    mutate(country=pais)
  
  df1_aux <- df
  
  df_final <- rbind(df_final, df1_aux)
  
}

ggplot(df_final , aes(label, proportion)) +
        facet_grid(country ~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+ 
 scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring order and security") +
        labs(x = "Response", y = "%") +
        geom_col()
```

+ Dictatorships are justified when they bring economic benefits 2009-2016: LS2P03D - LS3G02D (DUMMY)

```{r dum2, warning=FALSE, cache=FALSE, results="asis"}
aux09_i <- c("chi09", "mex09", "col09", "dom09","gtm", "pry","")
aux16_i <- c("chi16", "mex16", "col16", "dom16", "", "","per")
pais0_i <- c("CHL","MEX","COL","DOM","GTM","PRY","PER")
pais_i  <- c("CHI","MEX","COL","DOM","GTM","PRY","PER")

df_final <- NULL 

for(i in 1:7){
  
if(aux09_i[i]!="") {aux09 <- get(aux09_i[i])}
if(aux16_i[i]!="") {aux16 <- get(aux16_i[i])}
pais0 = pais0_i[i]
pais = pais_i[i]

aux09 <- aux09 %>% 
  mutate(dicta1 = case_when(
    dicta1 %in% c(1,2) ~ 1,
    dicta1 %in% c(3,4) ~ 2,
    is.na(dicta1) ~ dicta1,
    TRUE ~ 0
  )) %>% 
  mutate(dicta2 = case_when(
    dicta2 %in% c(1,2) ~ 1,
    dicta2 %in% c(3,4) ~ 2,
    is.na(dicta2) ~ dicta2,
    TRUE ~ 0
  )) 
aux16 <- aux16 %>% 
  mutate(dicta1 = case_when(
    dicta1 %in% c(1,2) ~ 1,
    dicta1 %in% c(3,4) ~ 2,
    is.na(dicta1) ~ dicta1,
    TRUE ~ 0
  )) %>% 
  mutate(dicta2 = case_when(
    dicta2 %in% c(1,2) ~ 1,
    dicta2 %in% c(3,4) ~ 2,
    is.na(dicta2) ~ dicta2,
    TRUE ~ 0
  )) 

if(aux09_i[i]!="" & aux16_i[i]!=""){ mergeiccs=full_join(aux16, aux09) }
if(aux09_i[i]!="" & aux16_i[i]==""){ mergeiccs= aux09 }
if(aux09_i[i]=="" & aux16_i[i]!=""){ mergeiccs= aux16 }

mergesvy <-  mergeiccs %>%
      filter(country==pais0) %>%
      as_survey_design(
      strata = jkzones, 
      weights = totwgts, 
      ids = jkreps, 
      nest = TRUE)

# frequency table via taylor series linearization
  table_freq_01 <- mergesvy %>%
    dplyr::group_by(time, dicta2) %>%
    summarize(proportion = survey_mean(,na.rm=TRUE))
  #help(srvyr)

  df = data.frame(table_freq_01, digits=2)

  df= df %>%
    mutate(perc = proportion * 100) %>%
    mutate(p=round(perc, 2)) %>%
    mutate(label=factor(dicta2, labels=c("Disagree", "Agree"))) %>% 
    mutate(country=pais)
  
  df1_aux <- df
  
  df_final <- rbind(df_final, df1_aux)
  
}

ggplot(df_final , aes(label, proportion)) +
        facet_grid(country ~ time) +
         geom_text(aes(label = p), position = position_dodge(0.3), vjust=-0.1)+ 
  scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
        theme(axis.text.x = element_text(angle =45, hjust = 1)) +
         ggtitle("Dictatorship are justified when bring economic benefits") +
        labs(x = "Response", y = "%") +
        geom_col()

```

# Sample 

+ All observations

```{r sample, echo=TRUE, eval=TRUE}
#Data frames with all variables
#2009
dict09 =  iccs09 %>%
  mutate(time          = 2008) %>%
  mutate(country       = COUNTRY) %>%
  mutate(idcountry     = IDCNTRY) %>%
  mutate(idschool       = IDSCHOOL) %>%
  mutate(idstudent     = IDSTUD) %>%
  mutate(idstudent = (time*1000000000000 + idcountry*100000000 + idstudent)) %>% #NEW IDSTUDENT
  mutate(dict_safety   = 5-LS2P03D) %>% #DICTATORSHIPS ARE JUSTIFIED WHEN THEY BRING ORDER AND SAFETY
  mutate(dict_benefits = 5-LS2P03E) %>% #DICTATORSHIPS ARE JUSTIFIED WHEN THEY BRING ECONOMIC BENEFITS
  mutate(dict          = (dict_safety + dict_benefits)/2) %>% #MEAN DIC
  mutate(pv1civ        = PV1CIV) %>%
  mutate(pv2civ        = PV2CIV) %>%
  mutate(pv3civ        = PV3CIV) %>%
  mutate(pv4civ        = PV4CIV) %>%
  mutate(pv5civ        = PV5CIV) %>%
  mutate(civic_knowledge = (pv1civ + pv2civ + pv3civ + pv4civ + pv5civ)/5) %>% #MEAN CIVIC KNOWLEDGE 
  mutate(s_intrust       = INTRUST) %>% #TRUST IN CIVIC INSTITUTIONS 
  mutate(s_opdisc        = OPDISC) %>%  #OPENNESS IN CLASS DISCUSSION
  mutate(s_hisced        = HISCED) %>%  #HIGHEST PARENTAL EDUCATIONAL LEVEL 
  mutate(univ            = ifelse(s_hisced>3, 1, 0)) %>% #UNIVERSITARY PARENTS
  mutate(s_hisei         = HISEI) %>%   #PARENT'S HIGHEST OCCUPATIONAL STATUS
  mutate(s_homelit       = HOMELIT) %>% #HOME LITERACY
  mutate(s_gender        = SGENDER) %>% #GENDER OF STUDENT
  mutate(s_citcon        = CITCON) %>%  #CONVENTIONAL CITIZENSHIP
  mutate(s_citsoc        = CITSOC) %>%  #SOCIAL MOVEMENT REL. CITIZENSHIP
  mutate(s_citeff        = CITEFF) %>%  #CITIZENSHIP SELF-EFFICACY 
  mutate(s_cntatt        = ATTCNT) %>%  #ATTITUDES TOWARDS OWN COUNTRY 
  mutate(s_geneql        = GENEQL) %>%  #ATTITUDES TOWARDS GENDER EQUALITY
  mutate(s_ethrght       = ETHRGHT) %>% #EQUAL RIGHTS FOR ALL ETHNIC GROUPS 
  mutate(l_attviol       = ATTVIOL) %>% #ATTITUDES: USE OF VIOLENCE 
  mutate(l_attdiv        = ATTDIFF) %>% #ATTITUDES: NEIGHBOURHOOD DIVERSITY
  mutate(l_autgov        = AUTGOV) %>%  #AUTHORITARIANISM IN GOVERNMENT 
  mutate(l_attcorr       = ATTCORR) %>% #CORRUPT PRACTICES IN GOVERNMENT
  mutate(l_dislaw        = DISLAW) %>%  #ATTITUDES: DISOBEYING THE LAW
  mutate(l_empclas       = EMPATH) %>%  #EMPATHY TOWARDS CLASSMATES
  mutate(s_poldisc       = POLDISC) %>% #DISCUSSION OF POL. AND SOC. ISSUES
  #TRUST
  mutate(nac_gob       = 5 - IS2P27A) %>% #TRUST INSTITUTIONS-NATIONAL GOVERNMENT  
  mutate(local_gob     = 5 - IS2P27B) %>% #TRUST INSTITUTIONS-LOCAL GOVERNMENT 
  mutate(courts        = 5 - IS2P27C) %>% #TRUST INSTITUTIONS-COURTS
  mutate(police        = 5 - IS2P27D) %>% #TRUST INSTITUTIONS-POLICE 
  mutate(pol_parties   = 5 - IS2P27E) %>% #TRUST INSTITUTIONS-POLITICAL PARTIES
  mutate(parliament    = 5 - IS2P27F) %>% #TRUST INSTITUTIONS-PARLIAMENT
  mutate(media         = 5 - IS2P27G) %>% #TRUST INSTITUTIONS-MEDIA
  mutate(ffaa          = 5 - IS2P27H) %>% #TRUST INSTITUTIONS-FFAA 
  mutate(school        = 5 - IS2P27I) %>% #TRUST INSTITUTIONS-SCHOOL
  mutate(unit_nations  = 5 - IS2P27J) %>% #TRUST INSTITUTIONS-UNITED NATIONS 
  mutate(people        = 5 - IS2P27K) %>% #TRUST INSTITUTIONS-PEOPLE
  #WEITHINGS5 - 
  mutate(totwgts       = TOTWGTS) %>%   #FINAL STUDENT WEIGHT
  mutate(wgtfac1       = WGTFAC1) %>%   #SCHOOL BASE WEIGHT
  mutate(wgtadj1s      = WGTADJ1S) %>%  #SCHOOL WEIGHT ADJUSTMENT-STUDENT STUDY
  mutate(wgtfac2s      = WGTFAC2S) %>%  #CLASS WEIGHT FACTOR
  mutate(wgtadj2s      = WGTADJ2S) %>%  #CLASS WEIGHT ADJUSTMENT
  mutate(wgtadj3s      = WGTADJ3S) %>%  #STUDENT WEIGHT ADJUSTMENT
  mutate(jkzones       = JKZONES) %>%   #JACKKNIFE ZONE - STUDENT STUDY
  mutate(jkreps        = JKREPS)  %>%  #JACKKNIFE REPLICATE CODE
  select(411:463)
 
#2016  
dict16 = iccs16 %>%
  mutate(time            = 2015) %>%
  mutate(country         = COUNTRY) %>%
  mutate(idcountry       = IDCNTRY) %>%
  mutate(idschool        = IDSCHOOL) %>%
  mutate(idstudent       = IDSTUD) %>%
  mutate(idstudent       = (time*100000000000 + idcountry*100000000 + idstudent)) %>% #NEW IDSTUDENT
  mutate(dict_safety     = 5-LS3G02D) %>% #DICTATORSHIPS ARE JUSTIFIED WHEN THEY BRING ORDER AND SAFETY
  mutate(dict_benefits   = 5-LS3G02E) %>% #DICTATORSHIPS ARE JUSTIFIED WHEN THEY BRING ECONOMIC BENEFITS
  mutate(dict          = (dict_safety + dict_benefits)/2) %>% 
  mutate(pv1civ          = PV1CIV) %>%
  mutate(pv2civ          = PV2CIV) %>%
  mutate(pv3civ          = PV3CIV) %>%
  mutate(pv4civ          = PV4CIV) %>%
  mutate(pv5civ          = PV5CIV) %>%
  mutate(civic_knowledge = (pv1civ + pv2civ + pv3civ + pv4civ + pv5civ)/5) %>% #MEAN CIVIC KNOWLEDGE 
  mutate(s_intrust       = S_INTRUST) %>% #TRUST IN CIVIC INSTITUTIONS 
  mutate(s_opdisc        = S_OPDISC) %>%  #OPENNESS IN CLASS DISCUSSION
  mutate(s_hisced        = S_HISCED) %>%  #HIGHEST PARENTAL EDUCATIONAL LEVEL 
  mutate(univ            = ifelse(s_hisced>3, 1, 0)) %>% #UNIVERSITARY PARENTS
  mutate(s_hisei         = S_HISEI) %>%   #PARENT'S HIGHEST OCCUPATIONAL STATUS
  mutate(s_homelit       = S_HOMLIT) %>%  #HOME LITERACY
  mutate(s_gender        = S_GENDER) %>%  #GENDER OF STUDENT
  mutate(s_citcon        = S_CITCON) %>%  #CONVENTIONAL CITIZENSHIP
  mutate(s_citsoc        = S_CITSOC) %>%  #SOCIAL MOVEMENT REL. CITIZENSHIP
  mutate(s_citeff        = S_CITEFF) %>%  #CITIZENSHIP SELF-EFFICACY 
  mutate(s_cntatt        = S_CNTATT) %>%  #ATTITUDES TOWARDS OWN COUNTRY 
  mutate(s_geneql        = S_GENEQL) %>%  #ATTITUDES TOWARDS GENDER EQUALITY
  mutate(s_ethrght       = S_ETHRGHT) %>% #EQUAL RIGHTS FOR ALL ETHNIC GROUPS 
  mutate(l_attviol       = L_ATTVIOL) %>% #ATTITUDES: USE OF VIOLENCE 
  mutate(l_attdiv        = L_ATTDIV) %>%  #ATTITUDES: NEIGHBOURHOOD DIVERSITY
  mutate(l_autgov        = L_AUTGOV) %>%  #AUTHORITARIANISM IN GOVERNMENT 
  mutate(l_attcorr       = L_ATTCORR) %>% #CORRUPT PRACTICES IN GOVERNMENT
  mutate(l_dislaw        = L_DISLAW) %>%  #ATTITUDES: DISOBEYING THE LAW
  mutate(l_empclas       = L_EMPCLAS) %>% #EMPATHY TOWARDS CLASSMATES
  mutate(s_poldisc       = S_POLDISC) %>% #DISCUSSION OF POL. AND SOC. ISSUES  
  #TRUST
  mutate(nac_gob         = 5 - IS3G26A) %>%   #TRUST INSTITUTIONS-NATIONAL GOVERNMENT 
  mutate(local_gob       = 5 - IS3G26B) %>%   #TRUST INSTITUTIONS-LOCAL GOVERNMENT 
  mutate(courts          = 5 - IS3G26C) %>%   #TRUST INSTITUTIONS-COURTS
  mutate(police          = 5 - IS3G26D) %>%   #TRUST INSTITUTIONS-POLICE
  mutate(pol_parties     = 5 - IS3G26E) %>%   #TRUST INSTITUTIONS-POLITICAL PARTIES
  mutate(parliament      = 5 - IS3G26F) %>%   #TRUST INSTITUTIONS-PARLIAMENT
  mutate(media           = 5 - IS3G26G) %>%   #TRUST INSTITUTIONS-MEDIA
  mutate(ffaa            = 5 - IS3G26I) %>%   #TRUST INSTITUTIONS-FFAA
  mutate(school          = 5 - IS3G26J) %>%   #TRUST INSTITUTIONS-SCHOOL
  mutate(unit_nations    = 5 - IS3G26K) %>%   #TRUST INSTITUTIONS-UNITED NATIONS
  mutate(people          = 5 - IS3G26L) %>%   #TRUST INSTITUTIONS-PEOPLE
  #WEITHINGS5 - 
  mutate(totwgts         = TOTWGTS) %>%   #FINAL STUDENT WEIGHT
  mutate(wgtfac1         = WGTFAC1) %>%   #SCHOOL BASE WEIGHT
  mutate(wgtadj1s        = WGTADJ1S) %>%  #SCHOOL WEIGHT ADJUSTMENT-STUDENT STUDY
  mutate(wgtfac2s        = WGTFAC2S) %>%  #CLASS WEIGHT FACTOR
  mutate(wgtadj2s        = WGTADJ2S) %>%  #CLASS WEIGHT ADJUSTMENT
  mutate(wgtadj3s        = WGTADJ3S) %>%  #STUDENT WEIGHT ADJUSTMENT
  mutate(jkzones         = JKZONES)  %>%  #JACKKNIFE ZONE - STUDENT STUDY
  mutate(jkreps          = JKREPS)  %>%  #JACKKNIFE REPLICATE CODE
  select(519:571)
#Merge data
dict <- rbind(dict09, dict16)
#All observations with complete row data
dict2 <- dict[complete.cases(dict),]
```

## Sample withiout missing

```{r sample2, echo=TRUE, eval=TRUE}
dict_count2 <- dict2 %>% 
  group_by(time, country) %>%
  dplyr::summarise(N=n(), Prop. = (n()/nrow(dict2)))  %>%
  arrange(country)
#Table
kable(dict_count2,  caption = "Sample without missing", format="html",
      col.names = c("Year","Country", "Prop.", "N")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```


# Support for Dictatorship and civic knowledge

+ Civic knowledge proxy: Mean to PV1CIV, PV2CIV, PV3CIV, PV4CIV, PV5CIV. Ajustar todas las estimaciones por el diseño. 

```{r Civic Knowledge, echo=TRUE, eval=TRUE}
#Proxy Civic Knowledge
civic_country_mean09 <- dict %>% filter(time==2008)  %>% group_by(country) %>%
  dplyr::summarise(mean=mean(civic_knowledge),sd=sd(civic_knowledge),n=n()) %>%
  dplyr::mutate(se=sd/sqrt(n)) %>%
  mutate (time=2008)

civic_country_mean16 <- dict %>% filter(time==2015)  %>% group_by(country) %>%  
  dplyr::summarise(mean=mean(civic_knowledge),sd=sd(civic_knowledge),n=n()) %>%
  dplyr::mutate(se=sd/sqrt(n)) %>%
  mutate (time=2015) 

civic_country_mean <- merge(civic_country_mean09, civic_country_mean16, all = T)

kable(civic_country_mean, align = c("cccccc"), caption = "Mean Civic Knowledge") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

#Graphs Bar
#All
civic_know <- ggplot(civic_country_mean, aes(reorder(to_label(country), -mean),mean), group = time)
civic_know <- civic_know +  geom_bar(stat = "summary") +
  facet_grid(~ time) + 
  geom_text(aes(label = format(mean, digits = 2), vjust=0.3, hjust=-0.2), size=2, colour="black") +
  coord_flip() +
  theme(axis.text=element_text(size=5,face="bold"),
        axis.title=element_text(size=10,face="bold")) + 
  labs(x="Country", y="Civic Knowledge")
civic_know

```

## Latin American 2009-2016: Dictatorship and civic knowledge

+ Dictatorships are justified when they bring economic benefits and civic knowledge

```{r Civic Knowledge and Dictatorship1, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring economic benefits 
scatter <- ggplot(dict, aes(civic_knowledge, l_autgov, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Civic knowledge", y = "Support for authoritarian practices", colour = "country") 
```

+ Dictatorships are justified when they bring order and safety and civic knowledge

```{r Civic Knowledge and Dictatorship2, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring order and safety 
scatter <- ggplot(dict, aes(civic_knowledge, dict_safety, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Civic knowledge", y = "Support to dictatorship (order and safety)", colour = "country")    
```

+ Dictatorships are justified (means of the previous two) and civic knowledge

```{r Civic Knowledge and Dictatorship3, echo=TRUE, eval=TRUE}
#Dictatorships are justified mean 
scatter <- ggplot(dict, aes(civic_knowledge, dict, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Civic knowledge", y = "Support to dictatorship (mean)", colour = "country")  
```

# Support for Dictatorship and institutional trust

## Latin American 2009-2016: Institutional trust

```{r Institutional trust, echo=TRUE, eval=TRUE}
in_trust09 <- dict2 %>% filter(time==2008)  %>% group_by(country) %>%
  dplyr::summarise(mean=mean(s_intrust),sd=sd(s_intrust),n=n()) %>%
  dplyr::mutate(se=sd/sqrt(n)) %>%
  mutate (time=2008)

in_trust16 <- dict2 %>% filter(time==2015)  %>% group_by(country) %>%  
  dplyr::summarise(mean=mean(s_intrust),sd=sd(s_intrust),n=n()) %>%
  dplyr::mutate(se=sd/sqrt(n)) %>%
  mutate (time=2015) 

in_trust_mean <- merge(in_trust09, in_trust16, all = T)

kable(in_trust_mean, align = c("cccccc"), caption = "Mean trust in civic institutions") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

#Graphs Bar
#All
bar_intrust <- ggplot(in_trust_mean, aes(reorder(to_label(country), mean),mean), group = time)
bar_intrust <- bar_intrust +  geom_bar(stat = "summary") +
  facet_grid(~ time) + 
  geom_text(aes(label = format(mean, digits = 2), vjust=0.3, hjust=-0.2), size=2, colour="black") +
  coord_flip() +
  theme(axis.text=element_text(size=5,face="bold"),
        axis.title=element_text(size=10,face="bold")) + 
  labs(x="Country", y="Trust in civic institutions")
bar_intrust
```


## Latin American 2009-2016: Dictatorship and institutional trust

+ Dictatorships are justified when they bring economic benefits and institutional trust

```{r Institutional trust and Dictatorship1, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring economic benefits 
scatter <- ggplot(dict, aes(s_intrust, l_autgov, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support for authoritarian practices", colour = "country") 
    
```


+ Dictatorships are justified when they bring order and safety and institutional trust

```{r Institutional trust and Dictatorship11, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring order and safety 
scatter <- ggplot(dict, aes(s_intrust, dict_safety, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support to dictatorship (order and safety)", colour = "country")    
```

+ Dictatorships are justified (means of the previous two) and institutional trust

```{r Institutional trust and Dictatorship12, echo=TRUE, eval=TRUE}
#Dictatorships are justified mean 
scatter <- ggplot(dict, aes(s_intrust, dict, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support to dictatorship (mean)", colour = "country")     
```


+ Dictatorships are justified when they bring economic benefits and institutional trust

```{r Institutional trust and Dictatorship2, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring economic benefits 
scatter <- ggplot(dict, aes(s_intrust, dict_benefits, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support to dictatorship (economic benefits)", colour = "country") 
    
```


+ Dictatorships are justified when they bring order and safety and institutional trust

```{r Institutional trust and Dictatorship21, echo=TRUE, eval=TRUE}
#Dictatorships are justified when they bring order and safety 
scatter <- ggplot(dict, aes(s_intrust, dict_safety, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support to dictatorship (order and safety)", colour = "country")    
```

+ Dictatorships are justified (means of the previous two) and institutional trust

```{r Institutional trust and Dictatorship22, echo=TRUE, eval=TRUE}
#Dictatorships are justified mean 
scatter <- ggplot(dict, aes(s_intrust, dict, colour = factor(country))) 
    scatter + geom_smooth(method = "lm", alpha = 0.1) + 
      facet_wrap(~ time) +
    labs(x = "Trust in civic institutions", y = "Support to dictatorship (mean)", colour = "country")     
```

## Latin American 2009-2016: Institutional trust and Civic Knowledge

+ Institutional trust in National government and Civic Knowledge

```{r nationalgob, echo=TRUE, eval=TRUE}
dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$nac_gob)
graf <- ggplot(dict2, aes(x=test, y=test2, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(y = "National Government", x = "Civic knowledge", colour = "country")
graf

dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$s_intrust)
graf <- ggplot(dict2, aes(x=test, y=test2, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(y = "Trust in civic institutions", x = "Civic knowledge", colour = "country")
graf


with(dict2,str(nac_gob))
```

+ Institutional trust in Local Goverment and Civic Knowledge

```{r localgob, echo=TRUE, eval=TRUE}
    dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$local_gob)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Local Government", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(local_gob))
```

+ Institutional trust in Courts of justicet and Civic Knowledge

```{r courts, echo=TRUE, eval=TRUE}
    dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$courts)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Courts of justice", y = "Civic knowledge", colour = "country")
graf
with(dict2,str(courts))
```

+ Institutional trust in Police and Civic Knowledge

```{r police, echo=TRUE, eval=TRUE}

   dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$police)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Police", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(police))

```

+ Institutional trust in Political Parties and Civic Knowledge

```{r polpart, echo=TRUE, eval=TRUE}
   dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$pol_parties)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Political Parties", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(pol_parties))

```

+ Institutional trust in National Parliament and Civic Knowledge

```{r parliament, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$parliament)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "National Parliament", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(parliament))  

```

+ Institutional trust in Media and Civic Knowledge

```{r media, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$media)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Media", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(media))  
```

+ Institutional trust in FFAA and Civic Knowledge

```{r ffaa, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$ffaa)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "FFAA", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(ffaa))  

```

+ Institutional trust in School and Civic Knowledge

```{r school, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$school)
graf <- ggplot(dict2, aes(x=test2, y=test, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Schools", y = "Civic knowledge", colour = "country")
graf

with(dict2,str(school)) 

```

+ Institutional trust in people and Civic Knowledge

```{r people, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$people)
graf <- ggplot(dict2, aes(x=test, y=test2, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Civic knowledge", y = "Trust: People in general", colour = "country")
graf

with(dict2,str(people)) 
```

+ Institutional trust index and Civic Knowledge

```{r index, echo=TRUE, eval=TRUE}
 dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$s_intrust)
graf <- ggplot(dict2, aes(x=test, y=test2, colour = factor(country)))  + geom_smooth(method = "lm", alpha = 0.1) + 
        facet_wrap(~ time) +
        labs(x = "Civic knowledge", y = "Trust in Civic Institutions Index", colour = "country")
graf

with(dict2,str(people)) 
```

+ Interaction between trust and civic knowledge on dictatorship support

```{r interaction, echo=TRUE, eval=TRUE}

library(sjPlot)
dict2$test = as.numeric(dict2$civic_knowledge)
dict2$test2 = as.numeric(dict2$s_intrust)

chile= dict2 %>%
       dplyr::filter(country=="CHL" & time=="2015") 

names(dict09)
fit= lm(l_autgov~ s_intrust*civic_knowledge + s_hisced + s_homelit + s_gender + s_poldisc+ time, data=dict2, w=totwgts)

summary(fit)

plot_model(fit, type = "pred", terms = c("s_intrust[20,80]", "civic_knowledge[200, 300, 400, 500, 600, 700, 800]"))

histogram(dict$pv1civ)
```


+ Multilevel SEM

```{r mlmsem, echo=TRUE, eval=TRUE}
#names(dict2)
library(lavaan)

dict2$know = dict2$civic_knowledge/100 #Reescalar conocimiento cívico
dict2$eduxknow = dict2$univ*dict2$know

#str(dict2)
chile= dict2 %>%
       dplyr::filter(country=="CHL" & time=="2015") 

#skim(chile)

 model1 <- '
        level: 1
            s_intrust ~ know + univ 
            dict ~ know + univ 
        level: 2
            s_intrust ~~ dict
            nac_gob ~~ know
            dict ~~ know
    '


    fit1 <- sem(model = model1, data = chile, cluster = "idschool")
    summary(fit1)
    
    model2 <- '
        level: 1
            nac_gob ~ know + univ + eduxknow
            dict ~ know + univ + eduxknow
        level: 2
            nac_gob ~~ dict
            nac_gob ~~ know
            dict ~~ know
    '


    fit2 <- sem(model = model2, data = chile, cluster = "idschool")
    summary(fit2)
```
